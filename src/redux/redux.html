<!--<script src="../../node_modules/lodash/lodash.min.js"></script>-->
<script src="../../node_modules/redux/dist/redux.min.js"></script>
<script src="../../node_modules/localforage/dist/localforage.min.js"></script>
<script src="../../node_modules/redux-persist/dist/redux-persist.min.js"></script>
<script src="../../node_modules/@reactivex/rxjs/dist/global/Rx.js"></script>
<script src="redux-observable.min.js"></script>
<link rel="import" href="../../bower_components/polymer-redux/polymer-redux.html">
<!-- Importing stores -->
<link rel="import" href="main-store.html">

<script>
  (function () {

    /*
    Since I'm not using webpack yet, I'll use direct references into bundles.
    I'm not sure if Polymer 2.0 is leveraging webpack or supports includes.
     */
    const localForage = window.localforage;
    const persistStore = window['redux-persist'].persistStore;
    const autoRehydrate = window['redux-persist'].autoRehydrate;
    const createTransform = window['redux-persist'].createTransform;

    // Main redux combine reducer.
    const rootReducer = Redux.combineReducers({
      main: window.atlasLabs.stores.main.reducer
    });

    /*
    Because I don't have imports, I'm going to flatten out multiple arrays
    and pass them in as a single argument list.
     */
    const rootEpic = ReduxObservable.combineEpics.apply(
      ReduxObservable.combineEpics,
      [].concat.apply([], [
        window.atlasLabs.stores.main.epics
      ])
    );
    const epicMiddleware = ReduxObservable.createEpicMiddleware(rootEpic);

    // This is for the Chrome dev tools pugin for Redux, handy stuff
    const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || Redux.compose;

    // Time to make the magic sandwich! Yum!
    const store = Redux.createStore(
      rootReducer,
      composeEnhancers(
        Redux.applyMiddleware(epicMiddleware),
        autoRehydrate()
      )
    );

    // And, let's get all this persisting to the indexDb via localForage
    persistStore(store, {storage: localForage});

    // Expose the mixin for Polymer classes
    window.ReduxMixin = PolymerRedux(store);

  })();
</script>